"use strict";(function(){let a,o={theme:"chrome",fontSize:14,wrap:!0,icon:void 0,iconName:"sourcecode",autocomplete:!1};const p=e=>{const s=e.getParam("supercode_theme");s&&typeof s=="string"&&(o.theme=s);const n=e.getParam("supercode_font_size");typeof n=="number"&&n>0&&(o.fontSize=parseInt(n));const i=e.getParam("supercode_wrap");typeof i=="boolean"&&(o.wrap=i);const r=e.getParam("supercode_autocomplete");typeof r=="boolean"&&(o.autocomplete=r);const l=e.getParam("supercode_icon");if(l&&typeof l=="string"&&(o.iconName=l),o.icon=e.ui.registry.getAll().icons[o.iconName],!o.icon)throw new Error("Supercode Icon name is invalid")},m=()=>{const e=["https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.js","https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.15.1/beautify-html.min.js"];o.autocomplete&&e.push("https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ext-language_tools.min.js"),e.forEach(s=>{let n=document.createElement("script");n.src=s,n.type="text/javascript",document.body.appendChild(n)})},f=e=>{a=ace.edit(e),o.autocomplete&&a.setOptions({enableLiveAutocompletion:!0}),a.setTheme(`ace/theme/${o.theme}`),a.setFontSize(o.fontSize)},g=(e,s,n)=>{const i=s.cloneNode(!0);i.style.position="relative";const r=i.querySelector(".tox-menubar");r&&(r.innerHTML=`
                <b style='font-size: 14px; font-weight: bold; padding: 9px;'>Source Code Editor</b>
            `);let l=!0;if(i.querySelectorAll(".tox-tbtn, .tox-split-button").forEach(t=>{if(t.getAttribute("data-mce-name")!="supercode"){if(t.getAttribute("data-mce-name")==="overflow-button"){t.style.display="none",t.removeAttribute("data-mce-name");return}t.classList+=" tox-tbtn--disabled",t.removeAttribute("data-mce-name")}else l=!1,t.setAttribute("data-mce-name","supercode-toggle"),t.style.background="#a6ccf7",t.onclick=n}),l){const t=document.createElement("div");t.classList="tox-toolbar__group",t.style.position="absolute",t.style.right=0,t.style.height="100%";const c=document.createElement("button");c.classList="tox-tbtn",c.innerHTML=`<span class="tox-icon tox-tbtn__icon-wrap">${o.icon}</span>`,c.onclick=n,t.append(c),i.append(t)}e.append(i)},y=(e,s)=>{e.style.width=s+"px",e.style.height="100%",e.style.position="relative",e.innerHTML='<div class="supercode-editor" style="width: 100%; height: 100%; position: absolute; left:0; top:0"></div>',f(e.querySelector(".supercode-editor"))},h=e=>e.getParam("inline")!==!0,b=function(e){if(!h(e))return console.error("Supercode Plugin is not supported in inline mode"),!1;let s=0,n;p(e),m();const i=()=>{e.focus(),e.undoManager.transact(function(){e.setContent(a.getValue())}),e.selection.setCursorLocation(),e.nodeChanged(),e.execCommand("ToggleView",!1,"supercode")},r=c=>{(c.key===" "&&c.ctrlKey||c.key==="Escape")&&i()},l={onShow:c=>{const d=c.getContainer();d.style.padding=0,d.childElementCount===0&&(d.innerHTML='<div class="supercode-header"></div><div class="supercode-body no-tox-style" id="no-tox-style"></div>',d.addEventListener("keydown",r),g(d.querySelector(".supercode-header"),n,i),y(d.querySelector(".supercode-body "),s));let x=html_beautify(e.getContent()),u=ace.createEditSession(x,"ace/mode/html");u.setUseWrapMode(o.wrap),a.setSession(u),a.gotoLine(1/0),a.focus()},onHide:()=>{removeEventListener("keydown",r)}},t=function(){const c=e.getContainer();s||(s=c.clientWidth),n||(n=c.querySelector(".tox-editor-header")),e.execCommand("ToggleView",!1,"supercode")};return e.ui.registry.addView("supercode",l),e.ui.registry.addButton("supercode",{icon:o.iconName,tooltip:"Source Code Editor (Ctrl + space)",onAction:t}),e.shortcuts.add("ctrl+32","Toggles Source Code Editing Mode",t),{getMetadata:function(){return{name:"Source Code Editor",url:""}}}};tinymce.PluginManager.add("supercode",b)})();
